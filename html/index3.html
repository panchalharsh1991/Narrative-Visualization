<html>
<head>
<meta charset ="utf-8">
<script src="https://d3js.org/d3.v5.min.js"></script>
<style>
	
body {
	margin: auto;
	width: 650px;
	font: 12px arial;
}

</style>
</head>

<body>

<svg id="chart" width="650" height="400"></svg>

Select Offense: 
<select id="offense"></select>

<script>

d3.csv("../agg_crime.csv").then(d => chart(d))

function chart(csv) {

	//var keys = csv.columns.slice(1);
	//console.log(keys);

	var offenses = [...new Set(csv.map(d => d.Offense_Code_Group))]

	var options = d3.select("#offense").selectAll("option")
		.data(offenses)
	.enter().append("option")
		.text(d => d)

	var svg = d3.select("#chart"),
		margin = {top: 35, left: 35, bottom: 0, right: 0},
		width = +svg.attr("width") - margin.left - margin.right,
		height = +svg.attr("height") - margin.top - margin.bottom;

	var x = d3.scaleBand()
		.range([margin.left, width - margin.right])
		.padding(0.1)

	var y = d3.scaleLinear()
		.rangeRound([height - margin.bottom, margin.top])

	var xAxis = svg.append("g")
		.attr("transform", `translate(0,${height - margin.bottom})`)
		.attr("class", "x-axis")

	var yAxis = svg.append("g")
		.attr("transform", `translate(${margin.left},0)`)
		.attr("class", "y-axis")

	//var z = d3.scaleOrdinal()
		//.range(["steelblue"])
		//.domain(keys);

	update(d3.select("#offense").property("value"), 0)

	function update(input, speed) {

		var data = csv.filter(f => f.Offense_Code_Group == input)

		data.forEach(function(d) {
			d.total = Number(d.Number_of_Records)
			return d
		})
		console.log(data);
		
		y.domain([0, d3.max(data, function (d) {
				return Number(d.Number_of_Records);
			})]);

		svg.selectAll(".y-axis").transition().duration(speed)
			.call(d3.axisLeft(y).ticks(null, "s"))

		x.domain(data.map(function (d) {
			return d.Hour;
		}));

		svg.selectAll(".x-axis").transition().duration(speed)
			.call(d3.axisBottom(x).tickSizeOuter(0))

		svg.append("g")
			.data(data)
			.enter()
			.append("rect")
			.attr("fill","steelblue")
			.transition().duration(speed)
			.attr("x", function (d) {
					return x(d.Hour);
			})
			.attr("y", function (d) {
					return y(Number(d.Number_of_Records));
			})
			.attr("width", x.bandwidth())
			.attr("height", function (d) {
					return height - y(Number(d.Number_of_Records));
			});
	}

	var select = d3.select("#offense")
		.on("change", function() {
			update(this.value, 1000)
		})
}

</script>

</body>
</html>